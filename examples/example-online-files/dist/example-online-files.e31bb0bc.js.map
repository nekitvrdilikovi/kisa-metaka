{"version":3,"sources":["node_modules/kisa-metaka/src/utils.js","node_modules/kisa-metaka/src/keyboard-buffer.js","node_modules/kisa-metaka/src/state.js","node_modules/kisa-metaka/src/markup.js","node_modules/kisa-metaka/src/index.js","index.js"],"names":["getRandomNumberUpto","max","Math","floor","random","isPlaying","$audioElement","duration","paused","stopPlaying","pause","currentTime","startPlaying","loop","play","KeyBoardBuffer","constructor","clear","store","key","buffer","head","length","pressed","reduce","accumulator","current","concat","undefined","triggered","pattern","reversedPattern","split","reverse","join","State","state","activatedBullets","activatedMoney","get","getMarkup","config","window","outerWidth","outerHeight","images","bulletAbsoluteUrl","moneyAbsoluteUrl","sounds","konanAbsoluteUrl","dajPareAbsoluteUrl","attachKmToDom","div","document","createElement","id","innerHTML","body","appendChild","canvasId","KeyboardBuffer","bulletsTrigger","moneyTrigger","drawnBullets","drawnMoney","bulletRefreshInterval","moneyRefreshInterval","bulletFallingSpeed","moneyFallingSpeed","$bulletImageElement","$moneyImageElement","$konanAudioElement","$dajPareAudioElement","$canvas","$ctx","getRandomBulletPosition","x","width","y","getRandomMoneyPosition","height","clearCanvas","clearRect","drawBullet","bullet","push","forEach","drawnBullet","beginPath","drawImage","drawMoney","money","note","updateStateOnKeyPress","oldActivatedBullets","oldActivatedMoney","onStateChange","console","log","initialize","getElementById","getContext","onkeypress","event","setInterval","rootElementId"],"mappings":";;AKAA;;AAEA,CAAC,YAAW;AACV,MAAMyC,MAAM,GAAG;AACbI,IAAAA,MAAM,EAAE;AACNC,ADLN,AHAe,AEAf,ADAe,AFAR,MKKDA,AJLe/B,AEAfyB,ADAeL,AFARnC,KEAE,CAAY,GCAZ,GAAGyC,EFAH,CAAqB,EIKb,CFLC,CEMhB,ALNwB,GGAH,AHAMxC,GAAG,IAAIC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,MAAL,KAAgBH,GAA3B,CAAnC,gFKIK;AAGN8C,AJNJ/B,ACAAA,EDAAA,ACAAA,IGMI+B,OJNO,ACAA,GDAG,ACAA,MGMM,EACd,UFP0BL,MAAM,CAACC,UAAW,aAAYD,MAAM,CAACE,WAAY;AEGvE,ADEZ,AHJI,ACAA,KGCa,IJDR3B,ACAAmB,KDAL,ACAA,GAAa;AGQbY,AJPD,ACAGX,IGOFW,EHPEX,IGOI,EAAE,UHPU,EAAE,KADP;AGSXY,ADJN,AFHMX,AFFC,MKSDW,AHPAX,AFFOjC,KGEFoC,IHFW,EGEL,CAACI,AHFOvC,EEEL,EGOE,AHPA,EGQd,AFRG,CAAcwC,MHFa,IACpCxC,OGCyC,MHD5B,CAACC,QAAd,GAAyB,CAAzB,IAA8B,CAACD,aAAa,CAACE,MADxC,0DKQK;AAGN0C,AJTJhC,ACFe,EDEfA,GCFE,CGWEgC,CJTC,CAAC/B,GAAD,EAAM,WISW,EAChB;AAJI,ADFZ,AHHI,ACCD,KGHc,IJERC,MAAL,CAAY,KAAKC,IAAjB,IAAyBF,GAAzB;AIWAsF,AJVA,IIUAA,KJVKpF,IAAL,GAAY,CIUC,AJVA,EIUE,GJVGA,IAAL,GAAY,CAAb,IAAkB,KAAKD,MAAL,CAAYE,MAA1C;AIHa,AJId,ACADiB,AFHK,EEGLA,CGJA,EHIG,CFHQ9B,EEGL,SFHgB,GAAGH,aAAa,IAAI;AKc1C,AHVE,AFHFA,EAAAA,SEGS,IFHI,CEGC8B,AFHA1B,KEGZ,AFHF,SKaW+B,MAAX;AACD,ADTD,AHFElB,ACCC,AFHDjB,CKJF,CJMEiB,ADFAjB,IIIIqD,GHFG,GAAG,EGEE,CJJC,CAAChD,CIIC,UJJf,CIIF,EJJ8B,CAA5B;AIMF,AHHI,ADFH,CAHM,KIQDS,KHHK,AEEAqB,CCCC,GAAG,CHHCrB,CEEC,CAACyB,CCCCe,GHHR,CAAYpC,CEEZ,CAAcuB,IFFd,CACL,CAACtB,UECmC,CCC3B,AHFT,EGEN,AHFoBC,OAAd,KAA0BD,WAAW,CAACE,MAAZ,CAAmBD,OAAnB,CADrB,EAEL,EAFK,CAAP;AGIJ,AHAG,ACHDT,EAAAA,IEGImB,CFHC,GAAG,CEGC,GAAG,IAAID,cAAJ,EAAd;AAEA,AFJI,MEIE0B,GFJGzB,KAAL,GAAa,GEIG,GAAG,IAAvB;AACA,AHFEnB,ACFIoB,EDEJpB,IGEI6C,AFJAzB,CDEC,GAAG,QGEQ,GAAG,CFJC,EAAE,CEIxB,IFLiB;AEMjB,AHFI,ACFEC,AFLC,MISDyB,AFJAzB,AFLO1B,GCOJQ,MAAL,GGEc,AHFA,ADPO,CCONQ,CCFC,CEIC,AJTOtB,CEKN,CEItB,KHFkB,EAAYsB,IDPW,IAAI,CCO3B,CAAd;AGGJ,AHFI,ACLa,AFFftB,EAAAA,GEEE,CEOE0D,GHFG3C,IAAL,EDPW,CISC,AHFA,ADPAR,CCOZ,EGEe,CJTjB,CISF,EJTuB,IAArB,GGO4B4B,MAAM,CAACO,MAAP,CAAcC,gBAAiB;ACI7D,AHHG,ACFA,AFLD3C,EAAAA,IIUI2D,SJVS,CAACnD,IAAd,OIUyB,GAAG,EAA9B,CDHiC2B,MAAM,CAACO,MAAP,CAAcE,kBAAmB,YAjBlE;ACqBA,AJVC,CAHM,KIaDgB,oBAAoB,GAAG,GAA7B;AACA,AHJErC,AECK,ADnBoB,EDkBzBA,IGIIsC,ADHOhB,KFDF,CAACrB,OAAD,AECe,EFDL,CECQW,ECGL,GAAG,CDHQ,ECGnC,EDHuC;ACIvC,AHJI,AECF,MCGI2B,EDHEhB,EFDE7B,CECC,GAAG8B,GFDG,GAAG,EECE,CCGC,ADHAC,EFDE/B,CGIC,CAA1B,KHJoB,EAAhB,EECU,CAAuB,KAAvB,CAAZ;ACKF,AHLI,AECF6B,EAAAA,ECIEiB,CDJC,CAACd,EAAJ,EFDQxB,CECC,IAAT,QCIqB,EHLE,CGKCH,EHLEE,OGK5B,AHLmC,CAC5BE,KADqB,CACf,EADe,EAErBC,OAFqB,GAGrBC,IAHqB,CAGhB,EAHgB,CAAx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","file":"example-online-files.e31bb0bc.js","sourceRoot":"..","sourcesContent":["export const getRandomNumberUpto = max => Math.floor(Math.random() * max);\n\nexport const isPlaying = $audioElement =>\n  $audioElement.duration > 0 && !$audioElement.paused;\nexport const stopPlaying = $audioElement => {\n  $audioElement.pause();\n  $audioElement.currentTime = 0;\n};\nexport const startPlaying = $audioElement => {\n  $audioElement.loop = true;\n  $audioElement.play();\n};\n","export default class KeyBoardBuffer {\n  constructor() {\n    this.clear();\n  }\n  store(key) {\n    this.buffer[this.head] = key;\n    this.head = (this.head + 1) % this.buffer.length;\n  }\n  pressed() {\n    return this.buffer.reduce(\n      (accumulator, current) => accumulator.concat(current),\n      \"\"\n    );\n  }\n  clear() {\n    this.buffer = [undefined, undefined];\n    this.head = 0;\n  }\n  triggered(pattern) {\n    const pressed = this.pressed();\n    const reversedPattern = pattern\n      .split(\"\")\n      .reverse()\n      .join(\"\");\n\n    return pressed == pattern || pattern == reversedPattern;\n  }\n}\n","export default class State {\n  constructor() {\n    this.state = {\n      activatedBullets: false,\n      activatedMoney: false\n    };\n  }\n  get() {\n    return this.state;\n  }\n  clear() {\n    this.state = {\n      activatedBullets: false,\n      activatedMoney: false\n    };\n  }\n}\n","const getMarkup = config => `\n  <canvas id=\"km-canvas\" width=\"${window.outerWidth}\" height=\"${window.outerHeight}\"></canvas>\n  <img\n    style=\"visibility:hidden\"\n    src=\"${config.images.bulletAbsoluteUrl}\"\n    id=\"km-bullet\"\n    width=\"28\"\n    height=\"32\"\n  />\n  <img\n    style=\"visibility:hidden\"\n    src=\"${config.images.moneyAbsoluteUrl}\"\n    id=\"km-money\"\n    width=\"256\"\n    height=\"64\"\n  />\n  <audio id=\"km-konan\" src=\"${config.sounds.konanAbsoluteUrl}\"></audio>\n  <audio id=\"km-daj-pare\" src=\"${config.sounds.dajPareAbsoluteUrl}\"></audio>`;\n\nexport const attachKmToDom = config => {\n  const div = document.createElement(\"div\");\n  div.id = \"km\";\n  div.innerHTML = getMarkup(config);\n  document.body.appendChild(div);\n};\n","import {\n  getRandomNumberUpto,\n  isPlaying,\n  stopPlaying,\n  startPlaying\n} from \"./utils\";\nimport KeyboardBuffer from \"./keyboard-buffer\";\nimport State from \"./state\";\nimport { attachKmToDom } from \"./markup\";\n\nconst canvasId = \"km-canvas\";\n\nconst buffer = new KeyboardBuffer();\nconst state = new State();\n\nconst bulletsTrigger = \"km\";\nconst moneyTrigger = \"dp\";\nconst drawnBullets = [];\nconst drawnMoney = [];\n\nconst bulletRefreshInterval = 10;\nconst moneyRefreshInterval = 250;\nconst bulletFallingSpeed = 2.5;\nconst moneyFallingSpeed = 1;\n\nlet $bulletImageElement = undefined;\nlet $moneyImageElement = undefined;\nlet $konanAudioElement = undefined;\nlet $dajPareAudioElement = undefined;\nlet $canvas = undefined;\nlet $ctx = undefined;\n\nconst getRandomBulletPosition = () => {\n  return {\n    x: getRandomNumberUpto($canvas.width),\n    y: -10\n  };\n};\nconst getRandomMoneyPosition = () => {\n  return {\n    x: getRandomNumberUpto($canvas.width),\n    y: getRandomNumberUpto($canvas.height)\n  };\n};\nconst clearCanvas = () => {\n  $ctx.clearRect(0, 0, $canvas.width, $canvas.height);\n};\n\nconst drawBullet = () => {\n  if (!state.get().activatedBullets) return;\n\n  clearCanvas();\n  const bullet = getRandomBulletPosition();\n\n  drawnBullets.push(bullet);\n  drawnBullets.forEach(drawnBullet => {\n    drawnBullet.y += bulletFallingSpeed;\n    $ctx.beginPath();\n    $ctx.drawImage($bulletImageElement, drawnBullet.x, drawnBullet.y);\n  });\n};\nconst drawMoney = () => {\n  if (!state.get().activatedMoney) return;\n\n  clearCanvas();\n  const money = getRandomMoneyPosition();\n\n  drawnMoney.push(money);\n  drawnMoney.forEach(note => {\n    note.y += moneyFallingSpeed;\n    $ctx.beginPath();\n    $ctx.drawImage($moneyImageElement, note.x, note.y);\n  });\n};\n\nconst updateStateOnKeyPress = key => {\n  buffer.store(key);\n  const oldActivatedBullets = state.get().activatedBullets;\n  const oldActivatedMoney = state.get().activatedMoney;\n\n  if (buffer.triggered(bulletsTrigger)) {\n    state.get().activatedBullets = !oldActivatedBullets;\n    if (state.get().activatedBullets) state.get().activatedMoney = false;\n\n    buffer.clear();\n  }\n\n  if (buffer.triggered(moneyTrigger)) {\n    state.get().activatedMoney = !oldActivatedMoney;\n    if (state.get().activatedMoney) state.get().activatedBullets = false;\n\n    buffer.clear();\n  }\n};\nconst onStateChange = () => {\n  const activatedBullets = state.get().activatedBullets;\n  const activatedMoney = state.get().activatedMoney;\n\n  console.log(state.get());\n\n  if (activatedBullets) {\n    if (isPlaying($konanAudioElement)) return;\n    if (isPlaying($dajPareAudioElement)) stopPlaying($dajPareAudioElement);\n\n    startPlaying($konanAudioElement);\n    return;\n  }\n  if (activatedMoney) {\n    if (isPlaying($dajPareAudioElement)) return;\n    if (isPlaying($konanAudioElement)) stopPlaying($konanAudioElement);\n    startPlaying($dajPareAudioElement);\n    return;\n  }\n\n  if (!activatedBullets) {\n    clearCanvas();\n    drawnBullets.length = 0;\n    stopPlaying($konanAudioElement);\n  }\n  if (!activatedMoney) {\n    clearCanvas();\n    drawnMoney.length = 0;\n    stopPlaying($dajPareAudioElement);\n  }\n};\n\nexport const initialize = config => {\n  attachKmToDom(config);\n\n  $bulletImageElement = document.getElementById(\"km-bullet\");\n  $moneyImageElement = document.getElementById(\"km-money\");\n  $konanAudioElement = document.getElementById(\"km-konan\");\n  $dajPareAudioElement = document.getElementById(\"km-daj-pare\");\n  $canvas = document.getElementById(canvasId);\n  $ctx = $canvas.getContext(\"2d\");\n\n  document.onkeypress = event => {\n    updateStateOnKeyPress(event.key);\n    onStateChange();\n  };\n  setInterval(drawBullet, bulletRefreshInterval);\n  setInterval(drawMoney, moneyRefreshInterval);\n};\n","import { initialize } from \"kisa-metaka\";\n\n(function() {\n  const config = {\n    images: {\n      bulletAbsoluteUrl:\n        \"https://rawcdn.githack.com/nekitvrdilikovi/kisa-metaka/6d2c7be6a2081d38306c0996f6dbea4c20c16fb5/example/dist/bullet.png\",\n      moneyAbsoluteUrl:\n        \"https://rawcdn.githack.com/nekitvrdilikovi/kisa-metaka/6d2c7be6a2081d38306c0996f6dbea4c20c16fb5/example/dist/money.png\"\n    },\n    sounds: {\n      konanAbsoluteUrl:\n        \"https://rawcdn.githack.com/nekitvrdilikovi/kisa-metaka/6d2c7be6a2081d38306c0996f6dbea4c20c16fb5/example/dist/konan.mp3\",\n      dajPareAbsoluteUrl:\n        \"https://rawcdn.githack.com/nekitvrdilikovi/kisa-metaka/6d2c7be6a2081d38306c0996f6dbea4c20c16fb5/example/dist/daj-pare.mp3\"\n    },\n    rootElementId: \"km\"\n  };\n  initialize(config);\n})();\n"]}